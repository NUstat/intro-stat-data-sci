<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.7.33">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>7&nbsp; Randomization and Causality – Introduction to Statistics and Data Science</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./08-populations.html" rel="next">
<link href="./06-multiple-regression.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js" type="module"></script>
<script src="site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-ea385d0e468b0dd5ea5bf0780b1290d9.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap-e8de9bd59ba156b9e4cb33cd6f01d621.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script>
  MathJax = {
    tex: {
      inlineMath: [['$', '$'], ['\\(', '\\)']]
    }
  };
  </script>
  <script id="MathJax-script" async="" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js">
  </script>
<script src="site_libs/kePrint-0.0.1/kePrint.js"></script>
<link href="site_libs/lightable-0.0.1/lightable.css" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

</head>

<body class="nav-sidebar floating quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./07-causality.html">Statistical Theory</a></li><li class="breadcrumb-item"><a href="./07-causality.html"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Randomization and Causality</span></a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header sidebar-header-stacked">
      <a href="https://statistics.northwestern.edu/" class="sidebar-logo-link">
      <img src="./images/logos/StatisticsDataScience-LogoSemi-VertPurple.png" alt="" class="sidebar-logo py-0 d-lg-inline d-none">
      </a>
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Introduction to Statistics and Data Science</a> 
        <div class="sidebar-tools-main tools-wide">
    <a href="https://github.com/NUstat/intro-stat-data-sci" title="Source Code" class="quarto-navigation-tool px-1" aria-label="Source Code"><i class="bi bi-github"></i></a>
    <a href="./Introduction-to-Statistics-and-Data-Science.pdf" title="Download PDF" class="quarto-navigation-tool px-1" aria-label="Download PDF"><i class="bi bi-file-pdf"></i></a>
    <div class="dropdown">
      <a href="" title="Share" id="quarto-navigation-tool-dropdown-0" class="quarto-navigation-tool dropdown-toggle px-1" data-bs-toggle="dropdown" aria-expanded="false" role="link" aria-label="Share"><i class="bi bi-share"></i></a>
      <ul class="dropdown-menu" aria-labelledby="quarto-navigation-tool-dropdown-0">
          <li>
            <a class="dropdown-item sidebar-tools-main-item" href="https://twitter.com/intent/tweet?url=|url|">
              <i class="bi bi-twitter pe-1"></i>
            Twitter
            </a>
          </li>
          <li>
            <a class="dropdown-item sidebar-tools-main-item" href="https://www.facebook.com/sharer/sharer.php?u=|url|">
              <i class="bi bi-facebook pe-1"></i>
            Facebook
            </a>
          </li>
          <li>
            <a class="dropdown-item sidebar-tools-main-item" href="https://www.linkedin.com/sharing/share-offsite/?url=|url|">
              <i class="bi bi-linkedin pe-1"></i>
            LinkedIn
            </a>
          </li>
      </ul>
    </div>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Welcome</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./preface.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Preface</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true">
 <span class="menu-text">Getting started</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./01-getting-started.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Getting Started with Data in R</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true">
 <span class="menu-text">Data Exploration via the tidyverse</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./02-visualization.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Data Visualization</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./03-wrangling.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Data Wrangling</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./04-tidy.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Data Importing &amp; "Tidy Data"</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true">
 <span class="menu-text">Data Modeling</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./05-regression.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Basic Regression</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./06-multiple-regression.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Multiple Regression</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true">
 <span class="menu-text">Statistical Theory</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./07-causality.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Randomization and Causality</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./08-populations.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Populations and Generalizability</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./09-sampling-distributions.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Sampling Distributions</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="true">
 <span class="menu-text">Statistical Inference</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./10-confidence-intervals.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Confidence Intervals</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./11-p-values.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">P-values</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./12-hypothesis-tests.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Hypothesis tests</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./13-putting-together.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Putting it all together</span></span></a>
  </div>
</li>
          <li class="px-0"><hr class="sidebar-divider hi "></li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./references.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">References</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" role="navigation" aria-expanded="true">
 <span class="menu-text">Appendices</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-6" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./0a-statistical-background.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">A</span>&nbsp; <span class="chapter-title">Statistical Background</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./0b-solutions-exercise.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">B</span>&nbsp; <span class="chapter-title">Exercise solutions</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./0c-solutions-learning-checks.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">C</span>&nbsp; <span class="chapter-title">Learning check solutions</span></span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#needed-packages" id="toc-needed-packages" class="nav-link active" data-scroll-target="#needed-packages">Needed Packages</a></li>
  <li><a href="#sec-causal-questions" id="toc-sec-causal-questions" class="nav-link" data-scroll-target="#sec-causal-questions"><span class="header-section-number">7.1</span> Causal Questions</a></li>
  <li><a href="#sec-randomized-experiments" id="toc-sec-randomized-experiments" class="nav-link" data-scroll-target="#sec-randomized-experiments"><span class="header-section-number">7.2</span> Randomized experiments</a>
  <ul class="collapse">
  <li><a href="#random-processes-in-r" id="toc-random-processes-in-r" class="nav-link" data-scroll-target="#random-processes-in-r"><span class="header-section-number">7.2.1</span> Random processes in R</a></li>
  </ul></li>
  <li><a href="#sec-omitted-variables" id="toc-sec-omitted-variables" class="nav-link" data-scroll-target="#sec-omitted-variables"><span class="header-section-number">7.3</span> Omitted variables</a></li>
  <li><a href="#the-magic-of-randomization" id="toc-the-magic-of-randomization" class="nav-link" data-scroll-target="#the-magic-of-randomization"><span class="header-section-number">7.4</span> The magic of randomization</a>
  <ul class="collapse">
  <li><a href="#sec-ed-data" id="toc-sec-ed-data" class="nav-link" data-scroll-target="#sec-ed-data"><span class="header-section-number">7.4.1</span> Randomization Example</a></li>
  <li><a href="#estimating-the-treatment-effect" id="toc-estimating-the-treatment-effect" class="nav-link" data-scroll-target="#estimating-the-treatment-effect"><span class="header-section-number">7.4.2</span> Estimating the treatment effect</a></li>
  </ul></li>
  <li><a href="#if-you-know-z-what-about-multiple-regression" id="toc-if-you-know-z-what-about-multiple-regression" class="nav-link" data-scroll-target="#if-you-know-z-what-about-multiple-regression"><span class="header-section-number">7.5</span> If you know Z, what about multiple regression?</a></li>
  <li><a href="#what-if-you-dont-know-z" id="toc-what-if-you-dont-know-z" class="nav-link" data-scroll-target="#what-if-you-dont-know-z"><span class="header-section-number">7.6</span> What if you don’t know Z?</a></li>
  <li><a href="#sec-causality-conclusion" id="toc-sec-causality-conclusion" class="nav-link" data-scroll-target="#sec-causality-conclusion"><span class="header-section-number">7.7</span> Conclusion</a></li>
  <li><a href="#sec-ex07" id="toc-sec-ex07" class="nav-link" data-scroll-target="#sec-ex07"><span class="header-section-number">7.8</span> Exercises</a>
  <ul class="collapse">
  <li><a href="#sec-ex07-conceptual" id="toc-sec-ex07-conceptual" class="nav-link" data-scroll-target="#sec-ex07-conceptual"><span class="header-section-number">7.8.1</span> Conceptual</a></li>
  <li><a href="#sec-ex07-application" id="toc-sec-ex07-application" class="nav-link" data-scroll-target="#sec-ex07-application"><span class="header-section-number">7.8.2</span> Application</a></li>
  <li><a href="#sec-ex07-advanced" id="toc-sec-ex07-advanced" class="nav-link" data-scroll-target="#sec-ex07-advanced"><span class="header-section-number">7.8.3</span> Advanced</a></li>
  </ul></li>
  </ul>
<div class="toc-actions"><ul><li><a href="https://github.com/NUstat/intro-stat-data-sci/edit/main/07-causality.qmd" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://github.com/NUstat/intro-stat-data-sci/issues/new" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./07-causality.html">Statistical Theory</a></li><li class="breadcrumb-item"><a href="./07-causality.html"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Randomization and Causality</span></a></li></ol></nav>
<div class="quarto-title">
<h1 class="title"><span id="sec-causality" class="quarto-section-identifier"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Randomization and Causality</span></span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<p>In this chapter we kick off the third segment of this book: statistical theory. Up until this point, we have focused only on descriptive statistics and exploring the data we have in hand. Very often the data available to us is <strong>observational data</strong> – data that is collected via a survey in which nothing is manipulated or via a log of data (e.g., scraped from the web). As a result, any relationship we observe is limited to our specific sample of data, and the relationships are considered <strong>associational</strong>. In this chapter we introduce the idea of making inferences through a discussion of <strong>causality</strong> and <strong>randomization</strong>.</p>
<section id="needed-packages" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="needed-packages">Needed Packages</h3>
<p>Let’s load all the packages needed for this chapter (this assumes you’ve already installed them). If needed, read <a href="01-getting-started.html#sec-packages" class="quarto-xref"><span>Section 1.3</span></a> for information on how to install and load R packages.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="sec-causal-questions" class="level2" data-number="7.1">
<h2 data-number="7.1" class="anchored" data-anchor-id="sec-causal-questions"><span class="header-section-number">7.1</span> Causal Questions</h2>
<p>What if we wanted to understand not just if X is associated with Y, but if X <strong>causes</strong> Y? Examples of causal questions include:</p>
<ul>
<li>Does <em>smoking</em> cause <em>cancer</em>?</li>
<li>Do <em>after school programs</em> improve student <em>test scores</em>?</li>
<li>Does <em>exercise</em> make people <em>happier</em>?</li>
<li>Does exposure to <em>abstinence only education</em> lead to lower <em>pregnancy rates</em>?</li>
<li>Does <em>breastfeeding</em> increase baby <em>IQs</em>?</li>
</ul>
<p>Importantly, note that while these are all causal questions, they do not all directly use the word <em>cause</em>. Other words that imply causality include:</p>
<ul>
<li>Improve</li>
<li>Increase / decrease</li>
<li>Lead to</li>
<li>Make</li>
</ul>
<p>In general, the tell-tale sign that a question is causal is if the analysis is used to make an argument for changing a procedure, policy, or practice.</p>
</section>
<section id="sec-randomized-experiments" class="level2" data-number="7.2">
<h2 data-number="7.2" class="anchored" data-anchor-id="sec-randomized-experiments"><span class="header-section-number">7.2</span> Randomized experiments</h2>
<p>The gold standard for understanding causality is the <strong>randomized experiment</strong>. For the sake of this chapter, we will focus on experiments in which people are randomized to one of two conditions: treatment or control. Note, however, that this is just one scenario; for example, schools, offices, countries, states, households, animals, cars, etc. can all be randomized as well, and can be randomized to more than two conditions.</p>
<p>What do we mean by random? Be careful here, as the word “random” is used colloquially differently than it is statistically. When we use the word <strong>random</strong> in this context, we mean:</p>
<ul>
<li>Every person (or unit) has some chance (i.e., a non-zero probability) of being selected into the treatment or control group.</li>
<li>The selection is based upon a <strong>random process</strong> (e.g., names out of a hat, a random number generator, rolls of dice, etc.)</li>
</ul>
<p>In practice, a randomized experiment involves several steps.</p>
<ol type="1">
<li>Half of the sample of people is randomly assigned to the treatment group (T), and the other half is assigned to the control group (C).</li>
<li>Those in the treatment group receive a treatment (e.g., a drug) and those in the control group receive something else (e.g., business as usual, a placebo).</li>
<li>Outcomes (Y) in the two groups are observed for all people.</li>
<li>The effect of the treatment is calculated using a simple regression model, <span class="math display">\[\hat{y} = b_0 + b_1T \]</span> where <span class="math inline">\(T\)</span> equals 1 when the individual is in the treatment group and 0 when they are in the control group. Note that using the notation introduced in <a href="05-regression.html#sec-model2table" class="quarto-xref"><span>Section 5.2.2</span></a>, this would be the same as writing <span class="math inline">\(\hat{y} = b_0 + b_1\mathbb{1}_{\mbox{Trt}}(x)\)</span>. We will stick with the <span class="math inline">\(T\)</span> notation for now, because this is more common in randomized experiments in practice.</li>
</ol>
<p>For this simple regression model, <span class="math inline">\(b_1 = \bar{y}_T - \bar{y}_C\)</span> is the observed “treatment effect”, where <span class="math inline">\(\bar{y}_T\)</span> is the average of the outcomes in the treatment group and <span class="math inline">\(\bar{y}_C\)</span> is the average in the control group. This means that the “treatment effect” is simply the difference between the treatment and control group averages.</p>
<section id="random-processes-in-r" class="level3" data-number="7.2.1">
<h3 data-number="7.2.1" class="anchored" data-anchor-id="random-processes-in-r"><span class="header-section-number">7.2.1</span> Random processes in R</h3>
<p>There are several functions in R that mimic random processes. You have already seen one example in <a href="05-regression.html" class="quarto-xref">Chapters&nbsp;<span>5</span></a> and <a href="06-multiple-regression.html" class="quarto-xref"><span>6</span></a> when we used <code>sample_n</code> to randomly select a specifized number of rows from a dataset. The function <code>rbernoulli()</code> is another example, which allows us to mimic the results of a series of random coin flips. The first argument in the <code>rbernoulli()</code> function, <code>n</code>, specifies the number of trials (in this case, coin flips), and the argument <code>p</code> specifies the probability of “success”” for each trial. In our coin flip example, we can define “success” to be when the coin lands on heads. If we’re using a fair coin then the probability it lands on heads is 50%, so <code>p = 0.5</code>.</p>
<p>Sometimes a random process can give results that don’t <em>look</em> random. For example, even though any given coin flip has a 50% chance of landing on heads, it’s possible to observe many tails in a row, just due to chance. In the example below, 10 coin flips resulted in only 3 heads, and the first 7 flips were tails. Note that TRUE corresponds to the notion of “success”, so here TRUE = heads and FALSE = tails.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>coin_flips <span class="ot">&lt;-</span> <span class="fu">rbernoulli</span>(<span class="at">n =</span> <span class="dv">10</span>, <span class="at">p =</span> <span class="fl">0.5</span>)</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>coin_flips</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] FALSE FALSE FALSE FALSE FALSE FALSE  TRUE FALSE  TRUE  TRUE</code></pre>
</div>
</div>
<p>Importantly, just because the results don’t <em>look</em> random, does not mean that the results <em>aren’t</em> random. If we were to repeat this random process, we will get a different set of random results.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>coin_flips2 <span class="ot">&lt;-</span> <span class="fu">rbernoulli</span>(<span class="at">n =</span> <span class="dv">10</span>, <span class="at">p =</span> <span class="fl">0.5</span>)</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>coin_flips2</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1]  TRUE  TRUE FALSE  TRUE FALSE FALSE  TRUE FALSE FALSE  TRUE</code></pre>
</div>
</div>
<p>Random processes can appear unstable, particularly if they are done only a small number of times (e.g.&nbsp;only 10 coin flips), but if we were to conduct the coin flip procedure thousands of times, we would expect the results to stabilize and see on average 50% heads.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>coin_flips3 <span class="ot">&lt;-</span> <span class="fu">rbernoulli</span>(<span class="at">n =</span> <span class="dv">100000</span>, <span class="at">p =</span> <span class="fl">0.5</span>)</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>coin_flips3 <span class="sc">%&gt;%</span> </span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(value) <span class="sc">%&gt;%</span> </span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">percent =</span> <span class="dv">100</span> <span class="sc">*</span> n<span class="sc">/</span><span class="fu">sum</span>(n))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 × 3
  value     n percent
  &lt;lgl&gt; &lt;int&gt;   &lt;dbl&gt;
1 FALSE 49879    49.9
2 TRUE  50121    50.1</code></pre>
</div>
</div>
<p>Often times when running a randomized experiment in practice, you want to ensure that exactly half of your participants end up in the treatment group. In this case, you don’t want to flip a coin for each participant, because just by chance, you could end up with 63% of people in the treatment group, for example. Instead, you can imagine each participant having an ID number, which is then randomly sorted or shuffled. You could then assign the first half of the randomly sorted ID numbers to the treatment group, for example. R has many ways of mimicing this type of random assignment process as well, such as the <code>randomizr</code> package.</p>
</section>
</section>
<section id="sec-omitted-variables" class="level2" data-number="7.3">
<h2 data-number="7.3" class="anchored" data-anchor-id="sec-omitted-variables"><span class="header-section-number">7.3</span> Omitted variables</h2>
<p>In a randomized experiment, we showed in <a href="#sec-randomized-experiments" class="quarto-xref"><span>Section 7.2</span></a> that we can calculate the estimated causal effect (<span class="math inline">\(b_1\)</span>) of a treatment using a simple regression model.</p>
<p>Why can’t we use the same model to determine causality with observational data? Recall our discussion from <a href="05-regression.html#sec-correlation-is-not-causation" class="quarto-xref"><span>Section 5.3.2</span></a>. We have to be very careful not to make unwarranted causal claims from observational data, because there may be an <strong>omitted variable</strong> (Z), also known as a <strong>confounder</strong>:</p>
<p><img src="images/confounder.png" class="img-fluid"></p>
<p>Here are some examples:</p>
<ul>
<li>There is a positive relationship between sales of ice cream (X) from street vendors and crime (Y). Does this mean that eating ice cream causes increased crime? No.&nbsp;The omitted variable is the season and weather (Z). That is, there is a positive relationship between warm weather (Z) and ice cream consumption (X) and between warm weather (Z) and crime (Y).</li>
<li>Students that play an instrument (X) have higher grades (Y) than those that do not. Does this mean that playing an instrument causes improved academic outcomes? No.&nbsp;Some omitted variables here could be family socio-economic status and student motivation. That is, there is a positive relationship between student motivation (and a family with resources) (Z) and likelihood of playing an instrument (X) and between motivation / resources and student grades (Y).</li>
<li>Countries that eat a lot of chocolate (X) also win the most Nobel Prizes (Y). Does this mean that higher chocolate consumption leads to more Nobel Prizes? No.&nbsp;The omitted variable here is a country’s wealth (Z). Wealthier countries win more Nobel Prizes and also consume more chocolate.</li>
</ul>
<p>Examples of associations that are misinterpreted as causal relationships abound. To see more examples, check out this website: https://www.tylervigen.com/spurious-correlations.</p>
</section>
<section id="the-magic-of-randomization" class="level2" data-number="7.4">
<h2 data-number="7.4" class="anchored" data-anchor-id="the-magic-of-randomization"><span class="header-section-number">7.4</span> The magic of randomization</h2>
<p>If omitted variables / confounders are such a threat to determining causality in observational data, why aren’t they also a threat in randomized experiments?</p>
<p>The answer is simple: <strong>randomization</strong>. Because people are randomized to treatment and control groups, on average there is no difference between these two groups on any characteristics <em>other than their treatment</em>.</p>
<p>This means that before the treatment is given, on average the two groups (T and C) are equivalent to one another on every observed <em>and</em> unobserved variable. For example, the two groups should be similar in all <strong>pre-treatment</strong> variables: age, gender, motivation levels, heart disease, math ability, etc. Thus, when the treatment is assigned and implemented, any differences between outcomes <em>can be attributed to the treatment</em>.</p>
<section id="sec-ed-data" class="level3" data-number="7.4.1">
<h3 data-number="7.4.1" class="anchored" data-anchor-id="sec-ed-data"><span class="header-section-number">7.4.1</span> Randomization Example</h3>
<p>Let’s see the magic of randomization in action. Imagine that we have a promising new curriculum for teaching math to Kindergarteners, and we want to know whether or not the curriculum is effective. Let’s explore how a randomized experiment would help us test this. First, we’ll load in a dataset called <code>ed_data</code>. This data originally came from the Early Childhood Longitudinal Study (ECLS) program but has been adapted for this example. Let’s take a look at the data.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co"># ed_data &lt;- read_csv("https://docs.google.com/spreadsheets/d/e/2PACX-1vTQ9AvbzZ2DBIRmh5h_NJLpC_b4u8-bwTeeMxwSbGX22eBkKDt7JWMqnuBpAVad6-OXteFcjBY4dGqf/pub?gid=300215043&amp;single=true&amp;output=csv")</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(ed_data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 335
Columns: 10
$ ID           &lt;dbl&gt; 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17…
$ FEMALE       &lt;dbl&gt; 0, 1, 1, 1, 1, 0, 1, 0, 1, 0, 1, 1, 1, 1, 0, 1, 0, 1, 0, …
$ MINORITY     &lt;dbl&gt; 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 1, 0, 0, 1, 0, …
$ MOM_ED       &lt;chr&gt; "Some college", "Vocational/technical program", "Some col…
$ DAD_ED       &lt;chr&gt; "Vocational/technical program", "Some college", "Bachelor…
$ SES_CONT     &lt;dbl&gt; -0.27, -0.03, 0.48, -0.03, -0.66, 1.53, 0.20, 0.07, -0.32…
$ READ_pre     &lt;dbl&gt; 27.4, 32.5, 48.2, 43.9, 36.1, 95.8, 33.8, 33.1, 32.2, 44.…
$ MATH_pre     &lt;dbl&gt; 18.7, 30.6, 31.6, 31.4, 24.2, 49.8, 27.1, 27.4, 25.1, 41.…
$ Trt_rand     &lt;dbl&gt; 1, 0, 0, 0, 1, 1, 0, 0, 1, 1, 1, 0, 0, 0, 0, 0, 0, 1, 0, …
$ Trt_non_rand &lt;dbl&gt; 1, 1, 0, 1, 1, 0, 1, 1, 1, 0, 0, 1, 0, 0, 0, 1, 0, 1, 0, …</code></pre>
</div>
</div>
<p>It includes information on 335 Kindergarten students: indicator variables for whether they are female or minority students, information on their parents’ highest level of education, a continuous measure of the their socio-economic status (SES), and their reading and math scores. For our purposes, we will assume that these are all <strong>pre-treatment variables</strong> that are measured on students at the beginning of the year, before we conduct our (hypothetical) randomized experiment. We also have included two variables <code>Trt_rand</code> and <code>Trt_non_rand</code> for demonstration purposes, which we will describe below.</p>
<p>In order to conduct our randomized experiment, we could randomly assign half of the Kindergarteners to the treatment group to recieve the new curriculum, and the other half of the students to the control group to recieve the “business as usual” curriculum. <code>Trt_rand</code> is the result of this <em>random assignment</em>, and is an indicator variable for whether the student is in the treatment group (<code>Trt_rand == 1</code>) or the control group (<code>Trt_rand == 0</code>). By inspecting this variable, we can see that 167 students were assigned to treatment and 168 were assigned to control.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>ed_data <span class="sc">%&gt;%</span> </span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(Trt_rand)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 × 2
  Trt_rand     n
     &lt;dbl&gt; &lt;int&gt;
1        0   168
2        1   167</code></pre>
</div>
</div>
<p>Remember that because this treatment assignment was <strong>random</strong>, we don’t expect a student’s treatment status to be correlated with any of their other pre-treatment characteristics. In other words, students in the treatment and control groups should look approximately the same <em>on average</em>. Looking at the means of all the numeric variables by treatment group, we can see that this is true in our example. Note how the <code>summarise_if</code> function is working here; if a variable in the dataset is numeric, then it is summarized by calculating its <code>mean</code>.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>ed_data <span class="sc">%&gt;%</span> </span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(Trt_rand) <span class="sc">%&gt;%</span> </span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise_if</span>(is.numeric, mean) <span class="sc">%&gt;%</span> </span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span><span class="fu">c</span>(ID, Trt_non_rand))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 × 6
  Trt_rand FEMALE MINORITY SES_CONT READ_pre MATH_pre
     &lt;dbl&gt;  &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;
1        0  0.542    0.327    0.296     46.8     39.0
2        1  0.569    0.293    0.320     48.2     39.9</code></pre>
</div>
</div>
<p>Both the treatment and control groups appear to be approximately the same on average on the observed characteristics of gender, minority status, SES, and pre-treatment reading and math scores. Note that since <code>FEMALE</code> is coded as 0 - 1, the “mean” is simply the proportion of students in the dataset that are female. The same is true for <code>MINORITY</code>.</p>
<p>In our hypothetical randomized experiment, after randomizing students into the treatment and control groups, we would then implement the appropriate (new or business as usual) math curriculum throughout the school year. We would then measure student math scores again at the end of the year, and if we observed that the treatment group was scoring higher (or lower) on average than the control group, we could attribute that difference entirely to the new curriculum. We would not have to worry about other omitted variables being the cause of the difference in test scores, because randomization ensured that the two groups were equivalent on average on <em>all</em> pre-treatment characteristics, both observed and unobserved.</p>
<p>In comparison, in an observational study, the two groups are not equivalent on these pre-treatment variables. In the same example above, let us imagine where instead of being randomly assigned to treatment, instead students with lower SES are assigned to the new specialized curriculum (<code>Trt_non_rand = 1</code>), and those with higher SES are assigned to the business as usual curriculum (<code>Trt_non_rand = 0</code>). The indicator variable <code>Trt_non_rand</code> is the result of this non-random treatment group assignment process.</p>
<p>In this case, the table of comparisons between the two groups looks quite different:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>ed_data <span class="sc">%&gt;%</span> </span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(Trt_non_rand) <span class="sc">%&gt;%</span> </span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise_if</span>(is.numeric, mean) <span class="sc">%&gt;%</span> </span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span><span class="fu">c</span>(ID, Trt_rand))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 × 6
  Trt_non_rand FEMALE MINORITY SES_CONT READ_pre MATH_pre
         &lt;dbl&gt;  &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;
1            0  0.565    0.226    0.912     51.7     43.6
2            1  0.545    0.395   -0.300     43.3     35.3</code></pre>
</div>
</div>
<p>There are somewhat large differences between the treatment and control group on several pre-treatment variables in addition to SES (e.g.&nbsp;% minority, and reading and math scores). Notice that the two groups still appear to be balanced in terms of gender. This is because gender is in general not associated with SES. However, minority status and test scores are both correlated with SES, so assigning treatment based on SES (instead of via a random process) results in an imbalance on those other pre-treatment variables. Therefore, if we observed differences in test scores at the end of the year, it would be difficult to disambiguate whether the differences were caused by the intervention or due to some of these other pre-treatment differences.</p>
</section>
<section id="estimating-the-treatment-effect" class="level3" data-number="7.4.2">
<h3 data-number="7.4.2" class="anchored" data-anchor-id="estimating-the-treatment-effect"><span class="header-section-number">7.4.2</span> Estimating the treatment effect</h3>
<p>Imagine that the truth about this new curriculum is that it raises student math scores by 10 points, on average. We can use R to mimic this process and randomly generate post-test scores that raise the treatment group’s math scores by 10 points on average, but leave the control group math scores largely unchanged. Note that we will never know the true treatment effect in real life - the treatment effect is what we’re trying to estimate; this is for demonstration purposes only.</p>
<p>We use another random process function in R, <code>rnorm()</code> to generate these random post-test scores. Don’t worry about understanding exactly how the code below works, just note that in both the <code>Trt_rand</code> and <code>Trt_non_rand</code> case, we are creating post-treatment math scores that increase a student’s score by 10 points on average, if they received the new curriculum.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>ed_data <span class="ot">&lt;-</span> ed_data <span class="sc">%&gt;%</span> </span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">MATH_post_trt_rand =</span> </span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>           <span class="fu">case_when</span>(Trt_rand <span class="sc">==</span> <span class="dv">1</span> <span class="sc">~</span> MATH_pre <span class="sc">+</span> <span class="fu">rnorm</span>(<span class="dv">1</span>, <span class="dv">10</span>, <span class="dv">2</span>), </span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>                     Trt_rand <span class="sc">==</span> <span class="dv">0</span> <span class="sc">~</span> MATH_pre <span class="sc">+</span> <span class="fu">rnorm</span>(<span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">2</span>)),</span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">MATH_post_trt_non_rand =</span> </span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>           <span class="fu">case_when</span>(Trt_non_rand <span class="sc">==</span> <span class="dv">1</span> <span class="sc">~</span> MATH_pre <span class="sc">+</span> <span class="fu">rnorm</span>(<span class="dv">1</span>, <span class="dv">10</span>, <span class="dv">2</span>), </span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>                     Trt_non_rand <span class="sc">==</span> <span class="dv">0</span> <span class="sc">~</span> MATH_pre <span class="sc">+</span> <span class="fu">rnorm</span>(<span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">2</span>)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>By looking at the first 10 rows of this data in <a href="#tbl-post-scores" class="quarto-xref">Table&nbsp;<span>7.1</span></a>, we can convince ourselves that both the <code>MATH_post_trt_rand</code> and <code>MATH_post_trt_non_rand</code> scores reflect this truth that the treatment raises test scores by 10 points, on average. For example, we see that for student 1, they were assigned to the treatment group in both scenarios and their test scores increased from about 18 to about 28. Student 2, however, was only assigned to treatment in the second scenario, and their test scores increased from about 31 to 41, but in the first scenario since they did not receive the treatment, their score stayed at about 31. Remember that here we are showing two hypothetical scenarios that could have occurred for these students - one if they were part of a randomized experiment and one where they were part of an observational study - but in real life, the study would only be conducted one way on the students and not both.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>ed_data <span class="sc">%&gt;%</span> </span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(ID, MATH_pre, Trt_rand, </span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>         MATH_post_trt_rand, Trt_non_rand, </span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>         MATH_post_trt_non_rand) <span class="sc">%&gt;%</span> </span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(ID <span class="sc">&lt;=</span> <span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-layout-align="center">
<div id="tbl-post-scores" class="cell quarto-float quarto-figure quarto-figure-center anchored" data-layout-align="center">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-post-scores-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;7.1: Math scores for first 10 students, under random and non-random treatment assignment scenarios
</figcaption>
<div aria-describedby="tbl-post-scores-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output-display">
<table class="table do-not-create-environment cell caption-top table-sm table-striped small" data-quarto-postprocess="true">
<thead>
<tr class="header">
<th style="text-align: right;" data-quarto-table-cell-role="th">ID</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">MATH_pre</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Trt_rand</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">MATH_post_trt_rand</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Trt_non_rand</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">MATH_post_trt_non_rand</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">1</td>
<td style="text-align: right;">18.7</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">28.4</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">28.9</td>
</tr>
<tr class="even">
<td style="text-align: right;">2</td>
<td style="text-align: right;">30.6</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">31.2</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">40.8</td>
</tr>
<tr class="odd">
<td style="text-align: right;">3</td>
<td style="text-align: right;">31.6</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">32.2</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">31.3</td>
</tr>
<tr class="even">
<td style="text-align: right;">4</td>
<td style="text-align: right;">31.4</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">32.0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">41.6</td>
</tr>
<tr class="odd">
<td style="text-align: right;">5</td>
<td style="text-align: right;">24.2</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">34.0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">34.4</td>
</tr>
<tr class="even">
<td style="text-align: right;">6</td>
<td style="text-align: right;">49.8</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">59.5</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">49.5</td>
</tr>
<tr class="odd">
<td style="text-align: right;">7</td>
<td style="text-align: right;">27.1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">27.7</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">37.3</td>
</tr>
<tr class="even">
<td style="text-align: right;">8</td>
<td style="text-align: right;">27.4</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">27.9</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">37.5</td>
</tr>
<tr class="odd">
<td style="text-align: right;">9</td>
<td style="text-align: right;">25.1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">34.9</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">35.3</td>
</tr>
<tr class="even">
<td style="text-align: right;">10</td>
<td style="text-align: right;">41.9</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">51.6</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">41.6</td>
</tr>
</tbody>
</table>
</div>
</div>
</figure>
</div>
</div>
<p>Let’s examine how students in each group performed on the post-treatment math assessment on average in the first scenario where they were randomly assigned (i.e.&nbsp;using <code>Trt_rand</code> and <code>MATH_post_trt_rand</code>).</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>ed_data <span class="sc">%&gt;%</span> </span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(Trt_rand) <span class="sc">%&gt;%</span> </span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">post_trt_rand_avg =</span> <span class="fu">mean</span>(MATH_post_trt_rand))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 × 2
  Trt_rand post_trt_rand_avg
     &lt;dbl&gt;             &lt;dbl&gt;
1        0              39.6
2        1              49.6</code></pre>
</div>
</div>
<p>Remember that in a randomized experiment, we calculate the treatment effect by simply taking the difference in the group averages (i.e.&nbsp;<span class="math inline">\(\bar{y}_T - \bar{y}_C\)</span>), so here our estimated treatment effect is <span class="math inline">\(49.6 - 39.6 = 10.0\)</span>. Recall that we said this could be estimated using the simple linear regression model <span class="math inline">\(\hat{y} = b_0 + b_1T\)</span>. We can fit this model in R to verify that our estimated treatment effect is <span class="math inline">\(b_1 = 10.0\)</span>.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>fit <span class="ot">&lt;-</span> <span class="fu">lm</span>(MATH_post_trt_rand <span class="sc">~</span> Trt_rand, <span class="at">data =</span> ed_data)</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>fit</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = MATH_post_trt_rand ~ Trt_rand, data = ed_data)

Coefficients:
(Intercept)     Trt_rand  
       39.6         10.0  </code></pre>
</div>
</div>
<p>Let’s also look at the post-treatment test scores by group for the non-randomized experiment case.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>ed_data <span class="sc">%&gt;%</span> </span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(Trt_non_rand) <span class="sc">%&gt;%</span> </span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">post_trt_non_rand_avg =</span> <span class="fu">mean</span>(MATH_post_trt_non_rand))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 × 2
  Trt_non_rand post_trt_non_rand_avg
         &lt;dbl&gt;                 &lt;dbl&gt;
1            0                  43.3
2            1                  45.5</code></pre>
</div>
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>fit1_non_rand <span class="ot">&lt;-</span> <span class="fu">lm</span>(MATH_post_trt_non_rand <span class="sc">~</span> Trt_non_rand, <span class="at">data =</span> ed_data)</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(fit1_non_rand)<span class="sc">$</span>coefficients</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>             Estimate Std. Error t value  Pr(&gt;|t|)
(Intercept)     43.31      0.871   49.69 4.37e-156
Trt_non_rand     2.18      1.234    1.76  7.89e-02</code></pre>
</div>
</div>
<p>Note that even though the treatment raised student scores by 10 points on average, in the observational case we estimate the treatment effect is <em>much</em> smaller. This is because treatment was confounded with SES and other pre-treatment variables, so we could not obtain an accurate estimate of the treatment effect.</p>
</section>
</section>
<section id="if-you-know-z-what-about-multiple-regression" class="level2" data-number="7.5">
<h2 data-number="7.5" class="anchored" data-anchor-id="if-you-know-z-what-about-multiple-regression"><span class="header-section-number">7.5</span> If you know Z, what about multiple regression?</h2>
<p>In the previous sections, we made clear that you cannot calculate the causal effect of a treatment using a <em>simple</em> linear regression model unless you have random assignment. What about a <em>multiple</em> regression model?</p>
<p>The answer here is more complicated. We’ll give you an overview, but note that this is a tiny sliver of an introduction and that there is an entire <em>field</em> of methods devoted to this problem. The field is called <strong>causal inference methods</strong> and focuses on the conditions under and methods in which you can calculate causal effects in observational studies.</p>
<p>Recall, we said before that in an observational study, the reason you can’t attribute causality between X and Y is because the relationship is <strong>confounded</strong> by an omitted variable Z. What if we included Z in the model (making it no longer omitted), as in:</p>
<p><span class="math display">\[\hat{y} = b_0 + b_1T + b_2Z\]</span> As we learned in <a href="06-multiple-regression.html" class="quarto-xref"><span>Chapter 6</span></a>, we can now interpret the coefficient <span class="math inline">\(b_1\)</span> as <strong>the estimated effect of the treatment on outcomes, holding constant (or adjusting for) Z</strong>.</p>
<p>Importantly, the relationship between T and Y, adjusting for Z can be similar or different than the relationship between T and Y alone. In advance, you simply cannot know one from the other.</p>
<p>Let’s again look at our model <code>fit1_non_rand</code> that looked at the relationship between treatment and math scores, and compare it to a model that adjusts for the confounding variable SES.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>fit1_non_rand <span class="ot">&lt;-</span> <span class="fu">lm</span>(MATH_post_trt_non_rand <span class="sc">~</span> Trt_non_rand, <span class="at">data =</span> ed_data)</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(fit1_non_rand)<span class="sc">$</span>coefficients</span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>fit2_non_rand <span class="ot">&lt;-</span> <span class="fu">lm</span>(MATH_post_trt_non_rand <span class="sc">~</span> Trt_non_rand <span class="sc">+</span> SES_CONT, <span class="at">data =</span> ed_data)</span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(fit2_non_rand)<span class="sc">$</span>coefficients</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-layout-align="center">
<div class="cell-output cell-output-stdout">
<pre><code>             Estimate Std. Error t value  Pr(&gt;|t|)
(Intercept)     43.31      0.871   49.69 4.37e-156
Trt_non_rand     2.18      1.234    1.76  7.89e-02</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>             Estimate Std. Error t value Pr(&gt;|t|)
(Intercept)     38.22       1.49   25.73        0
Trt_non_rand     8.93       2.02    4.43        0
SES_CONT         5.57       1.34    4.17        0</code></pre>
</div>
</div>
<p>The two models give quite different indications of how effective the treatment is. In the first model, the estimate of the treatment effect is 2.176, but in the second model once we control for SES, the estimate is 8.931. Again, this is because in our non-random assignment scenario, treatment status was confounded with SES.</p>
<p>Importantly, in the randomized experiment case, controlling for confounders using a multiple regression model is <strong>not</strong> necessary - again, because of the randomization. Let’s look at the same two models using the data from the experimental case (i.e.&nbsp;using <code>Trt_rand</code> and <code>MATH_post_trt_rand</code>).</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>fit1_rand_exp <span class="ot">&lt;-</span> <span class="fu">lm</span>(MATH_post_trt_rand <span class="sc">~</span> Trt_rand, <span class="at">data =</span> ed_data)</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(fit1_rand_exp)<span class="sc">$</span>coefficients</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>            Estimate Std. Error t value  Pr(&gt;|t|)
(Intercept)     39.6      0.928   42.65 5.46e-137
Trt_rand        10.0      1.314    7.64  2.26e-13</code></pre>
</div>
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>fit2_rand_exp <span class="ot">&lt;-</span> <span class="fu">lm</span>(MATH_post_trt_rand <span class="sc">~</span> Trt_rand <span class="sc">+</span> SES_CONT, <span class="at">data =</span> ed_data)</span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(fit2_rand_exp)<span class="sc">$</span>coefficients</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>            Estimate Std. Error t value  Pr(&gt;|t|)
(Intercept)    37.68      0.883   42.67 7.98e-137
Trt_rand        9.89      1.205    8.21  5.11e-15
SES_CONT        6.37      0.798    7.98  2.37e-14</code></pre>
</div>
</div>
<p>We can see that both models give estimates of the treatment effect that are roughly the same (10.044 and 9.891), regardless of whether or not we control for SES. This is because randomization ensured that the treatment and control group were balanced on all pre-treatment characteristics - including SES, so there is no need to control for them in a multiple regression model.</p>
</section>
<section id="what-if-you-dont-know-z" class="level2" data-number="7.6">
<h2 data-number="7.6" class="anchored" data-anchor-id="what-if-you-dont-know-z"><span class="header-section-number">7.6</span> What if you don’t know Z?</h2>
<p>In the observational case, if you <em>know</em> the process through which people are assigned to or select treatment then the above multiple regression approach can get you pretty close to the causal effect of the treatment on the outcomes. This is what happened in our <code>fit2_non_rand</code> model above where we knew treatment was determined by SES, and so we controlled for it in our model.</p>
<p>But this is <strong>rarely</strong> the case. In most studies, selection of treatment is <strong>not based on a single variable</strong>. That is, before treatment occurs, those that will ultimately receive the treatment and those that do not might differ in a myriad of ways. For example, students that play instruments may not only come from families with more resources and have higher motivation, but may also play fewer sports, already be great readers, have a natural proclivity for music, or come from a musical family. As an analyst, it is typically very difficult – if not impossible – to know how and why some people selected a treatment and others did not.</p>
<p>Without randomization, here is the best approach:</p>
<ol type="1">
<li>Remember: your goal is to approximate a random experiment. You want the two groups to be similar on any and all variables that are related to uptake of the treatment and the outcome.</li>
<li>Think about the treatment selection process. Why would people choose to play an instrument (or not)? Attend an after-school program (or not)? Be part of a sorority or fraternity (or not)?</li>
<li>Look for variables in your data that you can use in a multiple regression to control for these other possible confounders. Pay attention to how your estimate of the treatment impact changes as you add these into your model (often it will decrease).</li>
<li>State very clearly the assumptions you are making, the variables you have controlled for, and the possible other variables you were unable to control for. Be tentative in your conclusions and make clear their limitations – that this work is suggestive and that future research – a randomized experiment – would be more definitive.</li>
</ol>
</section>
<section id="sec-causality-conclusion" class="level2" data-number="7.7">
<h2 data-number="7.7" class="anchored" data-anchor-id="sec-causality-conclusion"><span class="header-section-number">7.7</span> Conclusion</h2>
<p>In this chapter we’ve focused on the role of randomization in our ability to make inferences – here about causation. As you will see in the next few chapters, randomization is also important for making inferences from outcomes observed in a sample to their values in a population. But the importance of randomization goes even deeper than this – one could say that <strong>randomization is at the core of inferential statistics</strong>.</p>
<p>In situations in which treatment is <strong>randomly assigned</strong> or a sample is <strong>randomly selected</strong> from a population, as a result of <strong>knowing this mechanism</strong>, we are able to imagine and explore alternative realities – what we will call <strong>counter-factual thinking</strong> (<a href="09-sampling-distributions.html" class="quarto-xref"><span>Chapter 9</span></a>) – and form ways of understanding when “effects” are likely (or unlikely) to be found simply by chance – what we will call <strong>proof by stochastic contradiction</strong> (<a href="11-p-values.html" class="quarto-xref"><span>Chapter 11</span></a>).</p>
<p>Finally, we would be remiss to end this chapter without including this XKCD comic, which every statistician loves:</p>
<p><img src="images/causation.png" class="img-fluid"></p>
</section>
<section id="sec-ex07" class="level2" data-number="7.8">
<h2 data-number="7.8" class="anchored" data-anchor-id="sec-ex07"><span class="header-section-number">7.8</span> Exercises</h2>
<section id="sec-ex07-conceptual" class="level3" data-number="7.8.1">
<h3 data-number="7.8.1" class="anchored" data-anchor-id="sec-ex07-conceptual"><span class="header-section-number">7.8.1</span> Conceptual</h3>
<div id="exr-ch07-c01" class="theorem exercise">
<p><span class="theorem-title"><strong>Exercise 7.1</strong></span> Which of the following are necessary components of a randomized experiment? Select all that apply.</p>
<ol type="a">
<li>There is a non-zero probability of being selected into the treatment or control group for every unit</li>
<li>Every unit of the population is selected into the treatment or control group</li>
<li>A random process is used for selection</li>
<li>A random process is used for understanding the results</li>
<li>A random process is used for administration of the treatments</li>
</ol>
</div>
<div id="exr-ch07-c02" class="theorem exercise">
<p><span class="theorem-title"><strong>Exercise 7.2</strong></span> You are interested in determining how often a 4-sided die (with sides numbered 1-4) rolls the number <code>2</code>. Which of the following lines of code could you use to simulate 1000 rolls for this experiment?</p>
<ol type="a">
<li>1000*rbernoulli(n = 1, p = 0.25)</li>
<li>rep( rbernoulli(n = 1, p = 0.25), 1000)</li>
<li>rbernoulli(n = 0.25, p = 2)</li>
<li>rbernoulli(n = 1000, p = 0.25)</li>
<li>rbernoulli(n = 1000, p = 2)</li>
<li>rbernoulli(n = 1000, p = 1/6)</li>
</ol>
</div>
<div id="exr-ch07-c03" class="theorem exercise">
<p><span class="theorem-title"><strong>Exercise 7.3</strong></span> The more times the random procedure is conducted, the further our experimental probability diverges from the true probability.</p>
<ol type="a">
<li>TRUE</li>
<li>FALSE</li>
</ol>
</div>
<div id="exr-ch07-c04" class="theorem exercise">
<p><span class="theorem-title"><strong>Exercise 7.4</strong></span> Randomization allows you to determine causation because the treatment and control groups do not differ by any pre-treatment variables.</p>
<ol type="a">
<li>TRUE</li>
<li>FALSE</li>
</ol>
</div>
<div id="exr-ch07-c05" class="theorem exercise">
<p><span class="theorem-title"><strong>Exercise 7.5</strong></span> In most real life studies, selection of treatment is not based on a single variable. Which of the following are components of the best approach in this case?</p>
<ol type="a">
<li>Try to ensure that treatment and control groups are as similar as possible on all variables related to treatment assignment</li>
<li>Add additional treatment variables to ensure further randomization</li>
<li>Look for variables you can use to control for confounding</li>
<li>State your assumptions and limitations</li>
</ol>
</div>
<div id="exr-ch07-c06" class="theorem exercise">
<p><span class="theorem-title"><strong>Exercise 7.6</strong></span> Consider the following headline: “Students at private colleges have higher GPAs”. What conclusions can you infer?</p>
<ol type="a">
<li>private colleges causes higher GPAs, because this would be an observational study</li>
<li>private colleges are only correlated with higher GPAs, because this would be an observational study</li>
<li>private colleges causes higher GPAs, because this would be a randomized experiment</li>
<li>private colleges are only correlated with higher GPAs, because this would be a randomized experiment</li>
</ol>
</div>
<div id="exr-ch07-c07" class="theorem exercise">
<p><span class="theorem-title"><strong>Exercise 7.7</strong></span> Consider the following headline: “Video games cause violent behavior”. What conclusions can you infer?</p>
<ol type="a">
<li>video games cause violent behavior, because this would be an observational study</li>
<li>video games are only correlated with violent behavior, because this would be an observational study</li>
<li>video games cause violent behavior, because this would be a randomized experiment</li>
<li>video games are only correlated with violent behavior, because this would be a randomized experiment</li>
</ol>
</div>
<div id="exr-ch07-c08" class="theorem exercise">
<p><span class="theorem-title"><strong>Exercise 7.8</strong></span> Name a potential confounding variable for <a href="#exr-ch07-c06" class="quarto-xref">Exercise&nbsp;<span>7.6</span></a>. Name a potential confounding variable for <a href="#exr-ch07-c07" class="quarto-xref">Exercise&nbsp;<span>7.7</span></a>.</p>
</div>
<div id="exr-ch07-c09" class="theorem exercise">
<p><span class="theorem-title"><strong>Exercise 7.9</strong></span> You are designing an experiment where you provide the eastern half of a city with recommendations to decrease water consumption (treatment group), with the aim of determining the effectiveness of these recommendations. The western half of the city does not receive water consumption recommendations (control group). Would we expect that, on average, the pre-treatment characteristics are the same between the treatment and control groups?</p>
<ol type="a">
<li>Yes, because we have no reason to believe that different halves of the city differ</li>
<li>Yes, because the treatment itself is very mild</li>
<li>No, because we are not looking at characteristics other than water consumption</li>
<li>No, because the treatment and control groups were not randomized</li>
</ol>
</div>
<div id="exr-ch07-c10" class="theorem exercise">
<p><span class="theorem-title"><strong>Exercise 7.10</strong></span> A doctor is curious if a new drug he has just learned about is effective in improving symptoms for patients with illness <code>A</code>. To determine the effectiveness of this drug, the doctor randomizes his patients and prescribes half of these patients with the drug of interest, while leaving the other half to continue with existing methods. Simultaneously, however, the physical therapist for all the doctor’s patients is running his own study where he too randomized the doctor’s patients (independently of the doctor’s study) and prescribed half of the patients to a new pain relief therapy program.</p>
<p>In the context of the doctor’s study on the drug, the new pain relief therapy program is what type of variable?</p>
</div>
</section>
<section id="sec-ex07-application" class="level3" data-number="7.8.2">
<h3 data-number="7.8.2" class="anchored" data-anchor-id="sec-ex07-application"><span class="header-section-number">7.8.2</span> Application</h3>
<div id="exr-ch07-app1" class="theorem exercise">
<p><span class="theorem-title"><strong>Exercise 7.11</strong></span> Consider the following scenario:</p>
<p>At a large high school, the administrative personnel want to start an after school program for mathematics help for students. To determine if the program is effective, the administration asks all the math teachers at the school to provide recommendations of which students they believe would benefit from the program, and randomly selects 200 of these students. The trial mathematics program is implemented for the duration of the spring semester, and the administrative personnel consider the outcome to be the change in student’s percentile math score from the fall semester final to the spring semester final.</p>
<p>Based on the setup of this design, can the administrative personnel conclude that the after school program <strong>caused</strong> students to improve in mathematics? Discuss whether or not randomization was achieved and any limitations of the study.</p>
</div>
<div id="exr-ch07-app2" class="theorem exercise">
<p><span class="theorem-title"><strong>Exercise 7.12</strong></span> Consider the following scenario:</p>
<p>You are working for a potato chip company, and are tasked with designing an experiment to determine if potential customers across the US are more receptive to a more complicated graphic on the product compared to the original simple graphic. Due to production and shipping issues, however, the product with the original graphic can only be distributed on the Eastern half of the US and the product with the more complicated graphic can only be distributed on the Western half of the US.</p>
<p>How and why might the confounding variable geography impact your results and conclusions? Can you brainstorm any ways to reduce the impact of this confounding variable?</p>
</div>
</section>
<section id="sec-ex07-advanced" class="level3" data-number="7.8.3">
<h3 data-number="7.8.3" class="anchored" data-anchor-id="sec-ex07-advanced"><span class="header-section-number">7.8.3</span> Advanced</h3>
<div id="exr-ch07-adv1" class="theorem exercise">
<p><span class="theorem-title"><strong>Exercise 7.13</strong></span> A new study is published claiming that patients are more receptive to rehabilitation of spinal injuries if one wall in the treatment room is painted purple. The hospital you work for is fascinated by the study and wants to implement the study in their own location, but the study provides no empirical evidence of the effectiveness of the treatment.</p>
<p>You are tasked with designing a (randomized) experiment to determine the validity of this claim. Design a study and discuss the limitations of your study.</p>
</div>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp("https:\/\/nustat\.github\.io\/intro-stat-data-sci\/");
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./06-multiple-regression.html" class="pagination-link" aria-label="Multiple Regression">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Multiple Regression</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./08-populations.html" class="pagination-link" aria-label="Populations and Generalizability">
        <span class="nav-page-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Populations and Generalizability</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->




<footer class="footer"><div class="nav-footer"><div class="nav-footer-center"><div class="toc-actions d-sm-block d-md-none"><ul><li><a href="https://github.com/NUstat/intro-stat-data-sci/edit/main/07-causality.qmd" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://github.com/NUstat/intro-stat-data-sci/issues/new" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></div></div></footer></body></html>